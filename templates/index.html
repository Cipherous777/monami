<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Monami Chat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Poppins", sans-serif;
      }
      /* Neon glow effect for input box */
      .neon-glow {
        box-shadow: 0 0 10px rgba(59, 130, 246, 0.6),
          0 0 20px rgba(59, 130, 246, 0.4), 0 0 30px rgba(59, 130, 246, 0.2);
      }
      button#scroll-btn {
        bottom: 20%;
      }
      /* Auto expand textarea */
      textarea {
        min-height: 40px;
        max-height: 200px;
        overflow-y: auto;
      }
    </style>
  </head>
  <body class="bg-gray-900 flex flex-col items-center h-screen">
    <!-- Logo -->
    <div
      class="text-3xl font-bold text-blue-500 py-4 drop-shadow-[0_0_15px_rgba(59,130,246,0.8)]"
    >
      Monami
    </div>

    <!-- Chat Window -->
    <div
      id="chat"
      class="flex flex-col w-full flex-1 overflow-y-auto p-4 space-y-4"
    >
      {% for msg in messages %} {% if msg.type == 'user' %}
      <div class="flex justify-end">
        <div class="bg-blue-500 text-white p-3 rounded-2xl max-w-md shadow-lg">
          {{ msg.text }}
        </div>
      </div>
      {% else %}
      <div class="flex justify-start">
        <div class="bg-gray-800 text-white p-3 rounded-2xl max-w-md shadow-lg">
          {{ msg.text }}
        </div>
      </div>
      {% endif %} {% endfor %}
    </div>

    <!-- Input Area -->
    <form id="chat-form" class="w-full max-w-2xl p-4" action="/" method="post">
      <div class="flex items-end gap-2 bg-gray-800 p-3 rounded-2xl neon-glow">
        <textarea
          id="message"
          name="user_input"
          rows="1"
          placeholder="Type your message..."
          class="flex-1 bg-transparent text-white resize-none outline-none p-2 max-w-xl"
        ></textarea>
        <button
          type="submit"
          class="px-4 py-2 bg-blue-500 text-white rounded-xl shadow-lg hover:bg-blue-600 transition"
        >
          Send
        </button>
      </div>
    </form>
    <!-- Scroll to Bottom Button -->
    <!-- Scroll to Bottom Button -->
    <button
      id="scroll-btn"
      class="fixed bottom-13 left-1/2 -translate-x-1/2 bg-blue-500 text-white p-3 rounded-full shadow-lg hidden hover:bg-blue-600 transition w-12 h-12"
    >
      â¬‡
    </button>

    <script>
      const form = document.getElementById("chat-form");
      const chat = document.getElementById("chat");
      const textarea = document.getElementById("message");
      const scrollBtn = document.getElementById("scroll-btn"); // <-- add this

      // Auto expand textarea
      textarea.addEventListener("input", () => {
        textarea.style.height = "auto";
        textarea.style.height = textarea.scrollHeight + "px";
      });

      // Show/hide scroll button
      chat.addEventListener("scroll", () => {
        if (chat.scrollTop + chat.clientHeight < chat.scrollHeight - 50) {
          scrollBtn.classList.remove("hidden");
        } else {
          scrollBtn.classList.add("hidden");
        }
      });

      // Scroll to bottom when clicked
      scrollBtn.addEventListener("click", () => {
        chat.scrollTo({ top: chat.scrollHeight, behavior: "smooth" });
        scrollBtn.classList.add("hidden");
      });

      // Scroll to bottom on page load
      chat.scrollTop = chat.scrollHeight;
    </script>
  </body>
</html>
